{"version":3,"sources":["../src/environment.ts","../src/utils/offTopicPromptParser.ts","../src/errors/nimErrors.ts","../src/actions/actionGetTopic.ts","../src/utils/safetyPromptParser.ts","../src/actions/actionGetSafety.ts","../src/utils/jailbreakPromptParser.ts","../src/actions/actionGetJailBreak.ts","../src/actions/actionGetCosmos.ts","../src/utils/assetManager.ts","../src/utils/cosmosPromptParser.ts","../src/actions/actionGetDeepFake.ts","../src/utils/deepfakePromptParser.ts","../src/utils/aiImagePromptParser.ts","../src/actions/actionGetAIImage.ts","../src/index.ts"],"names":["ENV","NVIDIA_NIM_NETWORKS","nvidiaEnvSchema","z","getConfig","env","validateNvidiaNimConfig","runtime","envConfig","config","error","errorMessage","getNetworkConfig","parseOffTopicPrompt","prompt","defaultSystem","defaultUser","systemMatch","userMatch","NimError","code","message","severity","details","GRANULAR_LOG","logGranular","data","elizaLogger","getTopicAction","_runtime","_state","_options","callback","messageContent","networkConfig","systemContent","userContent","openai","OpenAI","messages","completion","response","offTopicResponse","actionGetTopic_default","parseSafetyPrompt","assistantMatch","getSafetyAction","userMessage","assistantMessage","safetyResponse","analysis","safetyStatus","actionGetSafety_default","parseJailbreakPrompt","promptMatch","getJailBreakAction","inputPrompt","axios","jailbreakStatus","score","scoreText","actionGetJailBreak_default","SUPPORTED_FORMATS","ASSETS_DIR","path","NVCF_ASSET_URL","AssetManager","apiKey","currentDir","assetsPath","fs","filePath","ext","mimeType","type","urlString","url","mime","contentType","extension","_","filename","mediaInput","description","fileData","headers","authorizeRes","assetId","file","uploadPath","targetDir","workspaceRoot","absoluteTargetDir","newFilename","newPath","cosmosImageDir","cosmosTempDir","cosmosVideoDir","isVideo","isImage","debugLog","parseCosmosPrompt","text","attachments","result","process","mediaMatch","queryMatch","mediaFile","cosmosDir","fullCosmosDir","mediaPath","invoke_url","kNvcfAssetUrl","getApiKey","kSupportedList","getCosmosDescriptionAction","parsedPrompt","assetManager","dataInput","postData","uploadHeaders","uploadResponse","mediaContent","promptContent","inferHeaders","payload","responseText","cosmosResponse","actionGetCosmos_default","parseDeepFakePrompt","imageAttachment","deepfakeDir","isBase64","getDeepFakeAction","imageB64","tempDir","absolutePath","stats","dirContents","dirError","tempPath","uploadedAsset","apiUrl","deepfakeResponse","processedImagePath","imageBuffer","faceCount","faceDescriptions","box","idx","analysisText","actionGetDeepFake_default","parseAIImagePrompt","aiImageDir","getAIImageAction","aiImageResponse","aiProbability","topSource","prev","curr","sourceConfidence","actionGetAIImage_default","spinner","ora","chalk","actions","NVIDIA_NIM_SPASH","actionTable","Table","action","statusTable","nvidiaNimPlugin","index_default"],"mappings":"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","file":"index.js","sourcesContent":["import { IAgentRuntime } from \"@elizaos/core\";\nimport { z } from \"zod\";\n\n// Environment Variables\nlet ENV: string = \"production\";\n\n// NVIDIA NIM API Configuration\nconst NVIDIA_NIM_NETWORKS = {\n    production: {\n        baseUrl: process.env.NVIDIA_NIM_BASE_URL || \"https://integrate.api.nvidia.com/v1\",\n        apiKey: process.env.NVIDIA_NIM_API_KEY\n    },\n    sandbox: {\n        baseUrl: process.env.NVIDIA_NIM_SANDBOX_URL || \"https://integrate.api.nvidia.com/v1\",\n        apiKey: process.env.NVIDIA_NIM_SANDBOX_API_KEY\n    }\n} as const;\n\nexport const nvidiaEnvSchema = z.object({\n    NVIDIA_NIM_ENV: z.enum([\"production\", \"sandbox\"]).default(\"production\"),\n    NVIDIA_NIM_SPASH: z.boolean().default(false),\n    NVIDIA_NIM_API_KEY: z.string(),\n    NVIDIA_NIM_MAX_RETRIES: z.string().transform(Number).default(\"3\"),\n    NVIDIA_NIM_RETRY_DELAY: z.string().transform(Number).default(\"1000\"),\n    NVIDIA_NIM_TIMEOUT: z.string().transform(Number).default(\"5000\"),\n    NVIDIA_NIM_LOG_LEVEL: z.enum([\"error\", \"warn\", \"info\", \"debug\"]).default(\"info\"),\n    NVIDIA_GRANULAR_LOG: z.boolean().default(false),\n    NVIDIA_OFFTOPIC_SYSTEM: z.string().default(\"You are a topic control assistant. Your role is to analyze if the user's message is on-topic or off-topic based on the context and guidelines provided. Respond with a clear analysis of whether the message is appropriate for the given context.\"),\n    NVIDIA_OFFTOPIC_USER: z.string().default(\"Please analyze if this message is on-topic or off-topic.\"),\n    NVIDIA_NIM_BASE_VISION_URL: z.string().optional(),\n    NVIDIA_NIM_BASE_URL: z.string().optional(),\n    NVIDIA_COSMOS_INVOKE_URL: z.string().optional(),\n    NVIDIA_COSMOS_ASSET_URL: z.string().optional()\n});\n\nexport type NvidiaNimConfig = z.infer<typeof nvidiaEnvSchema>;\n\nexport function getConfig(\n    env: string | undefined | null = ENV ||\n        process.env.NVIDIA_NIM_ENV\n): NvidiaNimConfig {\n    ENV = env || \"production\";\n\n    return {\n        NVIDIA_NIM_ENV: (env as \"production\" | \"sandbox\") || \"production\",\n        NVIDIA_NIM_SPASH: process.env.NVIDIA_NIM_SPASH === \"true\" || false,\n        NVIDIA_NIM_API_KEY: process.env.NVIDIA_NIM_API_KEY || \"\",\n        NVIDIA_NIM_MAX_RETRIES: Number(process.env.NVIDIA_NIM_MAX_RETRIES || \"3\"),\n        NVIDIA_NIM_RETRY_DELAY: Number(process.env.NVIDIA_NIM_RETRY_DELAY || \"1000\"),\n        NVIDIA_NIM_TIMEOUT: Number(process.env.NVIDIA_NIM_TIMEOUT || \"5000\"),\n        NVIDIA_NIM_LOG_LEVEL: (process.env.NVIDIA_NIM_LOG_LEVEL as \"error\" | \"warn\" | \"info\" | \"debug\") || \"info\",\n        NVIDIA_GRANULAR_LOG: process.env.NVIDIA_GRANULAR_LOG === \"true\" || false,\n        NVIDIA_OFFTOPIC_SYSTEM: process.env.NVIDIA_OFFTOPIC_SYSTEM || \"You are a topic control assistant. Your role is to analyze if the user's message is on-topic or off-topic based on the context and guidelines provided. Respond with a clear analysis of whether the message is appropriate for the given context.\",\n        NVIDIA_OFFTOPIC_USER: process.env.NVIDIA_OFFTOPIC_USER || \"Please analyze if this message is on-topic or off-topic.\",\n        NVIDIA_NIM_BASE_VISION_URL: process.env.NVIDIA_NIM_BASE_VISION_URL,\n        NVIDIA_NIM_BASE_URL: process.env.NVIDIA_NIM_BASE_URL,\n        NVIDIA_COSMOS_INVOKE_URL: process.env.NVIDIA_COSMOS_INVOKE_URL,\n        NVIDIA_COSMOS_ASSET_URL: process.env.NVIDIA_COSMOS_ASSET_URL\n    };\n}\n\nexport async function validateNvidiaNimConfig(\n    runtime: IAgentRuntime\n): Promise<NvidiaNimConfig> {\n    try {\n        const envConfig = getConfig(\n            runtime.getSetting(\"NVIDIA_NIM_ENV\") ?? undefined\n        );\n\n        // Add debug logging\n        console.log(\"Debug - API Key sources:\", {\n            env: process.env.NVIDIA_NIM_API_KEY ? \"present\" : \"missing\",\n            runtime: runtime.getSetting(\"NVIDIA_NIM_API_KEY\") ? \"present\" : \"missing\",\n            envConfig: envConfig.NVIDIA_NIM_API_KEY ? \"present\" : \"missing\"\n        });\n\n        const config = {\n            NVIDIA_NIM_ENV: process.env.NVIDIA_NIM_ENV || runtime.getSetting(\"NVIDIA_NIM_ENV\") || envConfig.NVIDIA_NIM_ENV,\n            NVIDIA_NIM_SPASH: process.env.NVIDIA_NIM_SPASH || runtime.getSetting(\"NVIDIA_NIM_SPASH\") || envConfig.NVIDIA_NIM_SPASH,\n            NVIDIA_NIM_API_KEY: runtime.getSetting(\"NVIDIA_NIM_API_KEY\") || process.env.NVIDIA_NIM_API_KEY || \"\",\n            NVIDIA_NIM_MAX_RETRIES: process.env.NVIDIA_NIM_MAX_RETRIES || runtime.getSetting(\"NVIDIA_NIM_MAX_RETRIES\") || envConfig.NVIDIA_NIM_MAX_RETRIES.toString(),\n            NVIDIA_NIM_RETRY_DELAY: process.env.NVIDIA_NIM_RETRY_DELAY || runtime.getSetting(\"NVIDIA_NIM_RETRY_DELAY\") || envConfig.NVIDIA_NIM_RETRY_DELAY.toString(),\n            NVIDIA_NIM_TIMEOUT: process.env.NVIDIA_NIM_TIMEOUT || runtime.getSetting(\"NVIDIA_NIM_TIMEOUT\") || envConfig.NVIDIA_NIM_TIMEOUT.toString(),\n            NVIDIA_NIM_LOG_LEVEL: process.env.NVIDIA_NIM_LOG_LEVEL || runtime.getSetting(\"NVIDIA_NIM_LOG_LEVEL\") || envConfig.NVIDIA_NIM_LOG_LEVEL,\n            NVIDIA_GRANULAR_LOG: process.env.NVIDIA_GRANULAR_LOG === \"true\" || runtime.getSetting(\"NVIDIA_GRANULAR_LOG\") === \"true\" || envConfig.NVIDIA_GRANULAR_LOG,\n            NVIDIA_OFFTOPIC_SYSTEM: process.env.NVIDIA_OFFTOPIC_SYSTEM || runtime.getSetting(\"NVIDIA_OFFTOPIC_SYSTEM\") || envConfig.NVIDIA_OFFTOPIC_SYSTEM,\n            NVIDIA_OFFTOPIC_USER: process.env.NVIDIA_OFFTOPIC_USER || runtime.getSetting(\"NVIDIA_OFFTOPIC_USER\") || envConfig.NVIDIA_OFFTOPIC_USER,\n            NVIDIA_NIM_BASE_VISION_URL: process.env.NVIDIA_NIM_BASE_VISION_URL || envConfig.NVIDIA_NIM_BASE_VISION_URL,\n            NVIDIA_NIM_BASE_URL: process.env.NVIDIA_NIM_BASE_URL || envConfig.NVIDIA_NIM_BASE_URL,\n            NVIDIA_COSMOS_INVOKE_URL: process.env.NVIDIA_COSMOS_INVOKE_URL || envConfig.NVIDIA_COSMOS_INVOKE_URL,\n            NVIDIA_COSMOS_ASSET_URL: process.env.NVIDIA_COSMOS_ASSET_URL || envConfig.NVIDIA_COSMOS_ASSET_URL\n        };\n\n        // Add validation logging\n        console.log(\"Debug - Final config:\", {\n            env: config.NVIDIA_NIM_ENV,\n            hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n            apiKeyLength: config.NVIDIA_NIM_API_KEY.length\n        });\n\n        return nvidiaEnvSchema.parse(config);\n    } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        console.error(\"Config validation error:\", errorMessage);\n        throw new Error(`Failed to validate NVIDIA NIM configuration: ${errorMessage}`);\n    }\n}\n\n// Export network configurations\nexport const getNetworkConfig = (env: string = ENV) => {\n    const network = NVIDIA_NIM_NETWORKS[env as keyof typeof NVIDIA_NIM_NETWORKS];\n    return {\n        ...network,\n        baseVisionUrl: process.env.NVIDIA_NIM_BASE_VISION_URL || 'https://ai.api.nvidia.com/v1/vlm'\n    };\n};\n\n// AlphaFold2 Configuration\nexport const ALPHAFOLD2_CONFIG = {\n    API_KEY: process.env.NVIDIA_NIM_API_KEY,\n    NGC_KEY: process.env.NVIDIA_NGC_API_KEY,\n    API_URL: process.env.ALPHAFOLD_API_URL || 'https://health.api.nvidia.com/v1/biology/deepmind/alphafold2-multimer',\n    STATUS_URL: process.env.ALPHAFOLD_STATUS_URL || 'https://health.api.nvidia.com/v1/status',\n    SEQUENCES: {\n        SEQ1: process.env.SEQUENCE_ALPHA_FOLD2_1,\n        SEQ2: process.env.SEQUENCE_ALPHA_FOLD2_2\n    }\n} as const;\n\nexport interface NetworkConfig {\n    baseUrl: string;\n    baseVisionUrl: string;\n}\n","interface OffTopicParsedPrompt {\n    systemContent: string;\n    userContent: string;\n}\n\n/**\n * Parses a prompt string to extract system and user content for off-topic analysis\n * Format expected:\n * [SYSTEM]\n * System content here...\n * [/SYSTEM]\n *\n * [USER]\n * User content here...\n * [/USER]\n */\nexport function parseOffTopicPrompt(prompt: string, defaultSystem?: string, defaultUser?: string): OffTopicParsedPrompt {\n    const systemMatch = prompt.match(/\\[SYSTEM\\]([\\s\\S]*?)\\[\\/SYSTEM\\]/);\n    const userMatch = prompt.match(/\\[USER\\]([\\s\\S]*?)\\[\\/USER\\]/);\n\n    return {\n        systemContent: (systemMatch ? systemMatch[1].trim() : defaultSystem) || \"\",\n        userContent: (userMatch ? userMatch[1].trim() : defaultUser || prompt.trim()) || \"\"\n    };\n}\n\n/**\n * Creates a formatted off-topic prompt string\n */\nexport function createOffTopicPrompt(systemContent: string, userContent: string): string {\n    return `[SYSTEM]\n${systemContent}\n[/SYSTEM]\n\n[USER]\n${userContent}\n[/USER]`;\n}","export enum ErrorSeverity {\n    LOW = \"LOW\",\n    MEDIUM = \"MEDIUM\",\n    HIGH = \"HIGH\"\n}\n\nexport enum NimErrorCode {\n    VALIDATION_FAILED = \"VALIDATION_FAILED\",\n    API_ERROR = \"API_ERROR\",\n    NETWORK_ERROR = \"NETWORK_ERROR\",\n    PARSE_ERROR = \"PARSE_ERROR\",\n    FILE_NOT_FOUND = \"FILE_NOT_FOUND\",\n    DOWNLOAD_ERROR = \"DOWNLOAD_ERROR\",\n    FILE_OPERATION_FAILED = \"FILE_OPERATION_FAILED\"\n}\n\nexport class NimError extends Error {\n    code: NimErrorCode;\n    severity: ErrorSeverity;\n    details?: unknown;\n\n    constructor(code: NimErrorCode, message: string, severity: ErrorSeverity, details?: unknown) {\n        super(message);\n        this.code = code;\n        this.severity = severity;\n        this.details = details;\n        this.name = \"NimError\";\n    }\n}\n","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample } from \"@elizaos/core\";\nimport OpenAI from 'openai';\nimport type { ChatCompletionMessageParam } from \"openai/resources/chat/completions\";\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.js\";\nimport { parseOffTopicPrompt } from \"../utils/offTopicPromptParser.js\";\nimport { OffTopicContent, OffTopicResponse } from \"../types/offTopic.js\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[TopicControl] ${message}`, data);\n        console.log(`[TopicControl] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n// Action definition\nexport const getTopicAction: Action = {\n    name: \"GET_OFFTOPIC\",\n    similes: [\"CHECK_OFFTOPIC\", \"ANALYZE_OFFTOPIC\", \"OFFTOPIC_CONTROL\"],\n    description: \"Use NVIDIA NIM API to analyze and control off-topic relevance\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Check if the user message is on-topic or off-topic [SYSTEM]\\nYou are to act as an investor relations topic control system. Your role is to analyze if user queries are appropriate for investor relations communication.\\n[/SYSTEM]\\n\\n[USER]\\nCan you speculate on the potential impact of a recession on ABCs business?\\n[/USER]\",\n                userMessage: \"Can you speculate on the potential impact of a recession on ABCs business?\"\n            } as OffTopicContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"Off-topic analysis: The message is off-topic as it requests speculation about future business impacts, which is not appropriate for investor relations communication.\",\n                success: true,\n                data: {\n                    response: \"off-topic\"\n                }\n            } as OffTopicContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_OFFTOPIC\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_OFFTOPIC action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as OffTopicContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_OFFTOPIC\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_OFFTOPIC action\");\n\n        try {\n            const messageContent = message.content as OffTopicContent;\n            console.log(\"Debug - Message content:\", {\n                hasText: !!messageContent?.text,\n                hasUserMessage: !!messageContent?.userMessage\n            });\n\n            const config = await validateNvidiaNimConfig(runtime);\n            console.log(\"Debug - Config validated:\", {\n                hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n                env: config.NVIDIA_NIM_ENV\n            });\n\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            console.log(\"Debug - Network config:\", {\n                hasBaseUrl: !!networkConfig?.baseUrl,\n                baseUrl: networkConfig?.baseUrl\n            });\n\n            // Parse the prompt using our helper\n            const { systemContent, userContent } = parseOffTopicPrompt(\n                messageContent.text,\n                config.NVIDIA_OFFTOPIC_SYSTEM || \"\",\n                messageContent.userMessage || config.NVIDIA_OFFTOPIC_USER || \"\"\n            );\n\n            console.log(\"Debug - Parsed content:\", {\n                hasSystemContent: !!systemContent,\n                hasUserContent: !!userContent\n            });\n\n            // Initialize OpenAI client with NVIDIA configuration\n            const openai = new OpenAI({\n                apiKey: config.NVIDIA_NIM_API_KEY,\n                baseURL: networkConfig.baseUrl\n            });\n\n            // ------------------------------------------------------------------------------------------------\n            // Core off-topic analysis logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"nvidia/llama-3.1-nemoguard-8b-topic-control\",\n                systemContent,\n                userContent\n            });\n\n            try {\n                const messages: ChatCompletionMessageParam[] = [\n                    {\n                        role: \"system\",\n                        content: systemContent\n                    },\n                    {\n                        role: \"user\",\n                        content: userContent\n                    }\n                ];\n\n                const completion = await openai.chat.completions.create({\n                    model: \"nvidia/llama-3.1-nemoguard-8b-topic-control\",\n                    messages,\n                    temperature: 0.5,\n                    top_p: 1,\n                    max_tokens: 1024,\n                });\n\n                const response = completion.choices[0]?.message?.content || \"\";\n                const offTopicResponse: OffTopicResponse = {\n                    ...completion,\n                    prompt_logprobs: null\n                };\n\n                logGranular(\"Successfully received response from NVIDIA NIM\", {\n                    response,\n                    raw: offTopicResponse\n                });\n            // ------------------------------------------------------------------------------------------------\n            // End core logic\n            // ------------------------------------------------------------------------------------------------\n            // Callback to the framework to return the response\n            // ------------------------------------------------------------------------------------------------\n                if (callback) {\n                    callback({\n                        text: messageContent.text,\n                        userMessage: messageContent.userMessage,\n                        success: true\n                    } as OffTopicContent);\n                }\n\n                if (callback) {\n                    callback({\n                        text: `Off-Topic Analysis: ${response}`,\n                        success: true,\n                        userMessage: messageContent.userMessage,\n                        data: {\n                            response,\n                            raw: offTopicResponse\n                        }\n                    } as OffTopicContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing off-topic content: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        userMessage: messageContent.userMessage,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as OffTopicContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_OFFTOPIC action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_OFFTOPIC action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getTopicAction;\n\n","interface SafetyParsedPrompt {\n    userMessage: string;\n    assistantMessage?: string;\n}\n\n/**\n * Parses a prompt string to extract user and assistant messages for safety analysis\n * Format expected:\n * [USER]\n * User message here...\n * [/USER]\n *\n * [ASSISTANT]\n * Assistant message here...\n * [/ASSISTANT]\n */\nexport function parseSafetyPrompt(prompt: string): SafetyParsedPrompt {\n    const userMatch = prompt.match(/\\[USER\\]([\\s\\S]*?)\\[\\/USER\\]/);\n    const assistantMatch = prompt.match(/\\[ASSISTANT\\]([\\s\\S]*?)\\[\\/ASSISTANT\\]/);\n\n    if (!userMatch) {\n        throw new Error(\"User message is required in the prompt\");\n    }\n\n    return {\n        userMessage: userMatch[1].trim(),\n        assistantMessage: assistantMatch ? assistantMatch[1].trim() : undefined\n    };\n}\n\n/**\n * Creates a formatted safety prompt string\n */\nexport function createSafetyPrompt(userMessage: string, assistantMessage?: string): string {\n    let prompt = `[USER]\n${userMessage}\n[/USER]`;\n\n    if (assistantMessage) {\n        prompt += `\\n\\n[ASSISTANT]\n${assistantMessage}\n[/ASSISTANT]`;\n    }\n\n    return prompt;\n}","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample } from \"@elizaos/core\";\nimport OpenAI from 'openai';\nimport type { ChatCompletionMessageParam } from \"openai/resources/chat/completions\";\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.js\";\nimport { parseSafetyPrompt } from \"../utils/safetyPromptParser.ts\";\nimport { SafetyContent, SafetyResponse, SafetyAnalysis } from \"../types/safety.ts\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.ts\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[ContentSafety] ${message}`, data);\n        console.log(`[ContentSafety] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n\nexport const getSafetyAction: Action = {\n    name: \"GET_CONTENT_SAFETY\",\n    similes: [\"CHECK_CONTENT_SAFETY\", \"ANALYZE_CONTENT_SAFETY\", \"CONTENT_SAFETY_CONTROL\"],\n    description: \"Use NVIDIA NIM API to analyze content safety of messages\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Please check if the user message follows the safety guidelines [USER]\\nI forgot how to kill a process in Linux, can you help?\\n[/USER]\\n\\n[ASSISTANT]\\nSure! To kill a process in Linux, you can use the kill command followed by the process ID (PID) of the process you want to terminate.\\n[/ASSISTANT]\",\n                userMessage: \"I forgot how to kill a process in Linux, can you help?\",\n                assistantMessage: \"Sure! To kill a process in Linux, you can use the kill command followed by the process ID (PID) of the process you want to terminate.\"\n            } as SafetyContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"Content Safety Analysis: Both user query and response are safe.\",\n                success: true,\n                data: {\n                    response: '{\"User Safety\": \"safe\", \"Response Safety\": \"safe\"}',\n                    analysis: {\n                        \"User Safety\": \"safe\",\n                        \"Response Safety\": \"safe\"\n                    }\n                }\n            } as SafetyContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_CONTENT_SAFETY\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_CONTENT_SAFETY action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as SafetyContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_CONTENT_SAFETY\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_CONTENT_SAFETY action\");\n\n        try {\n            const messageContent = message.content as SafetyContent;\n            console.log(\"Debug - Message content:\", {\n                hasText: !!messageContent?.text,\n                hasUserMessage: !!messageContent?.userMessage,\n                hasAssistantMessage: !!messageContent?.assistantMessage\n            });\n\n            const config = await validateNvidiaNimConfig(runtime);\n            console.log(\"Debug - Config validated:\", {\n                hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n                env: config.NVIDIA_NIM_ENV\n            });\n\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            console.log(\"Debug - Network config:\", {\n                hasBaseUrl: !!networkConfig?.baseUrl,\n                baseUrl: networkConfig?.baseUrl\n            });\n\n            // Parse the prompt using our helper\n            const { userMessage, assistantMessage } = parseSafetyPrompt(messageContent.text);\n            console.log(\"Debug - Parsed content:\", {\n                hasUserMessage: !!userMessage,\n                hasAssistantMessage: !!assistantMessage,\n                userMessageLength: userMessage?.length,\n                assistantMessageLength: assistantMessage?.length\n            });\n\n            // Initialize OpenAI client with NVIDIA configuration\n            const openai = new OpenAI({\n                apiKey: config.NVIDIA_NIM_API_KEY,\n                baseURL: networkConfig.baseUrl\n            });\n\n            // ------------------------------------------------------------------------------------------------\n            // Core content safety analysis logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"nvidia/llama-3.1-nemoguard-8b-content-safety\",\n                userMessage,\n                assistantMessage\n            });\n\n            try {\n                const messages: ChatCompletionMessageParam[] = [\n                    {\n                        role: \"user\",\n                        content: userMessage\n                    }\n                ];\n\n                if (assistantMessage) {\n                    messages.push({\n                        role: \"assistant\",\n                        content: assistantMessage\n                    });\n                }\n\n                const completion = await openai.chat.completions.create({\n                    model: \"nvidia/llama-3.1-nemoguard-8b-content-safety\",\n                    messages,\n                    temperature: 0.5,\n                    top_p: 1,\n                    max_tokens: 1024,\n                });\n\n                const response = completion.choices[0]?.message?.content || \"\";\n                const safetyResponse: SafetyResponse = {\n                    ...completion,\n                    prompt_logprobs: null\n                };\n\n                // Parse the JSON response\n                let analysis: SafetyAnalysis | undefined;\n                try {\n                    analysis = JSON.parse(response) as SafetyAnalysis;\n                } catch (error) {\n                    throw new NimError(\n                        NimErrorCode.PARSE_ERROR,\n                        \"Failed to parse safety analysis response\",\n                        ErrorSeverity.HIGH,\n                        { response }\n                    );\n                }\n\n                logGranular(\"Successfully received response from NVIDIA NIM\", {\n                    response,\n                    analysis,\n                    raw: safetyResponse\n                });\n            // ------------------------------------------------------------------------------------------------\n            // End core logic\n            // ------------------------------------------------------------------------------------------------\n\n                if (callback) {\n                    const safetyStatus = analysis?.[\"User Safety\"] === \"safe\" && analysis?.[\"Response Safety\"] === \"safe\"\n                        ? \"Both user query and response are safe\"\n                        : \"Safety concerns detected\";\n\n                    callback({\n                        text: `Content Safety Analysis: ${safetyStatus}`,\n                        success: true,\n                        userMessage,\n                        assistantMessage,\n                        data: {\n                            response,\n                            analysis,\n                            raw: safetyResponse\n                        }\n                    } as SafetyContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing content safety: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        userMessage,\n                        assistantMessage,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as SafetyContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_CONTENT_SAFETY action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_CONTENT_SAFETY action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getSafetyAction;\n\n","interface JailbreakParsedPrompt {\n    inputPrompt: string;\n}\n\n/**\n * Parses a prompt string to extract the input prompt for jailbreak detection\n * Format expected:\n * [PROMPT]\n * Input prompt text here...\n * [/PROMPT]\n */\nexport function parseJailbreakPrompt(prompt: string): JailbreakParsedPrompt {\n    const promptMatch = prompt.match(/\\[PROMPT\\]([\\s\\S]*?)\\[\\/PROMPT\\]/);\n\n    if (!promptMatch) {\n        // If no explicit prompt markers, treat the entire text as the prompt\n        return {\n            inputPrompt: prompt.trim()\n        };\n    }\n\n    return {\n        inputPrompt: promptMatch[1].trim()\n    };\n}\n\n/**\n * Creates a formatted jailbreak detection prompt string\n */\nexport function createJailbreakPrompt(inputPrompt: string): string {\n    return `[PROMPT]\n${inputPrompt}\n[/PROMPT]`;\n}","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample } from \"@elizaos/core\";\nimport OpenAI from 'openai';\nimport type { ChatCompletionMessageParam } from \"openai/resources/chat/completions\";\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.ts\";\nimport { parseJailbreakPrompt } from \"../utils/jailbreakPromptParser.ts\";\nimport { JailbreakContent, JailbreakResponse, JailbreakAnalysis } from \"../types/jailbreak.ts\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.ts\";\nimport axios from 'axios';\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[JailbreakDetection] ${message}`, data);\n        console.log(`[JailbreakDetection] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n\nexport const getJailBreakAction: Action = {\n    name: \"GET_JAILBREAK\",\n    similes: [\"CHECK_JAILBREAK\", \"ANALYZE_JAILBREAK\", \"JAILBREAK_CONTROL\"],\n    description: \"Use NVIDIA NIM API to detect potential jailbreak attempts in prompts\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Analyze this prompt for potential jailbreak attempts [PROMPT]\\nWhat is the capital of France?\\n[/PROMPT]\",\n                inputPrompt: \"What is the capital of France?\"\n            } as JailbreakContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"Jailbreak Analysis: No jailbreak attempt detected.\",\n                success: true,\n                data: {\n                    response: '{\"jailbreak\": \"false\", \"score\": \"0.0123456789\"}',\n                    analysis: {\n                        jailbreak: \"false\",\n                        score: \"0.0123456789\"\n                    }\n                }\n            } as JailbreakContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_JAILBREAK\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_JAILBREAK action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as JailbreakContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_JAILBREAK\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_JAILBREAK action\");\n\n        try {\n            const messageContent = message.content as JailbreakContent;\n            console.log(\"Debug - Message content:\", {\n                hasText: !!messageContent?.text,\n                hasInputPrompt: !!messageContent?.inputPrompt\n            });\n\n            const config = await validateNvidiaNimConfig(runtime);\n            console.log(\"Debug - Config validated:\", {\n                hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n                env: config.NVIDIA_NIM_ENV\n            });\n\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            console.log(\"Debug - Network config:\", {\n                hasBaseUrl: !!networkConfig?.baseUrl,\n                baseUrl: networkConfig?.baseUrl\n            });\n\n            // Parse the prompt using our helper\n            const { inputPrompt } = parseJailbreakPrompt(messageContent.text);\n            console.log(\"Debug - Parsed content:\", {\n                hasInputPrompt: !!inputPrompt,\n                promptLength: inputPrompt?.length\n            });\n\n            // Initialize OpenAI client with NVIDIA configuration\n            const openai = new OpenAI({\n                apiKey: config.NVIDIA_NIM_API_KEY,\n                baseURL: networkConfig.baseUrl\n            });\n\n            // ------------------------------------------------------------------------------------------------\n            // Core jailbreak detection logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"nvidia/nemoguard-jailbreak-detect\",\n                inputPrompt\n            });\n\n            try {\n                const messages: ChatCompletionMessageParam[] = [\n                    {\n                        role: \"user\",\n                        content: inputPrompt\n                    }\n                ];\n\n                // Make the API request\n                const { data: response } = await axios.post(\n                    'https://ai.api.nvidia.com/v1/security/nvidia/nemoguard-jailbreak-detect',\n                    {\n                        input: inputPrompt\n                    },\n                    {\n                        headers: {\n                            \"Authorization\": `Bearer ${config.NVIDIA_NIM_API_KEY}`,\n                            \"Accept\": \"application/json\",\n                            \"Content-Type\": \"application/json\"\n                        }\n                    }\n                );\n\n                // The response is already a JavaScript object, no need to parse\n                const analysis: JailbreakAnalysis = {\n                    jailbreak: response.jailbreak.toString(),\n                    score: response.score.toString()\n                };\n\n                logGranular(\"Successfully received response from NVIDIA NIM\", {\n                    response,\n                    analysis\n                });\n\n                if (callback) {\n                    const jailbreakStatus = response.jailbreak\n                        ? \"Potential jailbreak attempt detected\"\n                        : \"No jailbreak attempt detected\";\n\n                    const score = (response.score * 100).toFixed(2);\n                    const scoreText = response.jailbreak\n                        ? `Jailbreak confidence: ${score}%`\n                        : `Safe with ${score}% confidence`;\n\n                    callback({\n                        text: `Jailbreak Analysis: ${jailbreakStatus}. ${scoreText}`,\n                        success: true,\n                        inputPrompt,\n                        data: {\n                            response: JSON.stringify(response),\n                            analysis,\n                            raw: response\n                        }\n                    } as JailbreakContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing jailbreak: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        inputPrompt,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as JailbreakContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_JAILBREAK action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_JAILBREAK action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getJailBreakAction;\n\n","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample } from \"@elizaos/core\";\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.js\";\nimport { parseCosmosPrompt } from \"../utils/cosmosPromptParser.js\";\nimport { CosmosContent, CosmosResponse, CosmosAnalysis } from \"../types/cosmos.js\";\nimport { AssetManager } from \"../utils/assetManager.js\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\nimport path from 'path';\nimport axios from 'axios';\nimport fs from 'fs';\n\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[CosmosVision] ${message}`, data);\n        console.log(`[CosmosVision] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n\n// Get URLs from environment config\nconst invoke_url = config.NVIDIA_COSMOS_INVOKE_URL || \"https://ai.api.nvidia.com/v1/vlm/nvidia/cosmos-nemotron-34b\";\nconst kNvcfAssetUrl = config.NVIDIA_COSMOS_ASSET_URL || \"https://api.nvcf.nvidia.com/v2/nvcf/assets\";\n\n// Get API key with proper error handling\nfunction getApiKey(config: any): string {\n    const apiKey = config.NVIDIA_NIM_API_KEY || process.env.TEST_NVCF_API_KEY;\n    if (!apiKey) {\n        throw new NimError(\n            NimErrorCode.VALIDATION_FAILED,\n            \"API key is missing. Please set NVIDIA_NIM_API_KEY or TEST_NVCF_API_KEY.\",\n            ErrorSeverity.HIGH\n        );\n    }\n    return apiKey;\n}\n\n// Type definitions for supported formats\ntype SupportedExtension = 'png' | 'jpg' | 'jpeg' | 'mp4';\ntype MediaInfo = [string, string]; // [mimeType, mediaType]\n\nconst kSupportedList: Record<SupportedExtension, MediaInfo> = {\n    \"png\": [\"image/png\", \"img\"],\n    \"jpg\": [\"image/jpg\", \"img\"],\n    \"jpeg\": [\"image/jpeg\", \"img\"],\n    \"mp4\": [\"video/mp4\", \"video\"]\n} as const;\n\n// Get file extension\nfunction getExtension(filename: string): string {\n    const ext = path.extname(filename).toLowerCase();\n    return ext.slice(1); // remove the leading dot\n}\n\n// Get MIME type\nfunction mimeType(ext: SupportedExtension): string {\n    return kSupportedList[ext][0];\n}\n\n// Get media type\nfunction mediaType(ext: SupportedExtension): string {\n    return kSupportedList[ext][1];\n}\n\nexport const getCosmosDescriptionAction: Action = {\n    name: \"GET_COSMOS_DESCRIPTION\",\n    similes: [\"CHECK_COSMOS_DESCRIPTION\", \"ANALYZE_COSMOS_DESCRIPTION\", \"COSMOS_DESCRIPTION_CONTROL\"],\n    description: \"Use NVIDIA Cosmos model to analyze and describe images or videos\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Analyze this image with the NVIDIA Cosmos [MEDIA]\\nsample.jpg\\n[/MEDIA]\\n[QUERY]\\nDescribe what's happening in this image\\n[/QUERY]\",\n                mediaPath: \"sample.jpg\"\n            } as CosmosContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"Scene Analysis: A person wearing a hard hat and safety vest is working in an industrial setting.\",\n                success: true,\n                data: {\n                    response: \"The worker, who is wearing a neon vest, black pants, and a yellow hard hat, is pulling a yellow caution tape across the aisle. This action suggests that he is cordoning off the area, likely for safety or maintenance reasons.\",\n                    analysis: {\n                        description: \"The worker, who is wearing a neon vest, black pants, and a yellow hard hat, is pulling a yellow caution tape across the aisle. This action suggests that he is cordoning off the area, likely for safety or maintenance reasons.\",\n                        confidence: 0.92\n                    }\n                }\n            } as CosmosContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_COSMOS_DESCRIPTION\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_COSMOS_DESCRIPTION action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as CosmosContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_COSMOS_DESCRIPTION\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_COSMOS_DESCRIPTION action\");\n\n        try {\n            const messageContent = message.content as CosmosContent;\n            const config = await validateNvidiaNimConfig(runtime);\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            const apiKey = getApiKey(config);\n\n            logGranular(\"API key configuration\", {\n                hasKey: !!apiKey,\n                length: apiKey?.length,\n                source: config.NVIDIA_NIM_API_KEY ? 'config' : process.env.TEST_NVCF_API_KEY ? 'env' : 'default'\n            });\n\n            // Parse the prompt using our helper\n            const parsedPrompt = await parseCosmosPrompt(messageContent.text);\n            logGranular(\"Parsed prompt\", parsedPrompt);\n\n            if (!parsedPrompt.mediaFile) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"No media file provided in the prompt\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            // Initialize asset manager\n            const assetManager = new AssetManager(config.NVIDIA_NIM_API_KEY);\n\n            // ------------------------------------------------------------------------------------------------\n            // Core Cosmos vision analysis logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"nvidia/cosmos-nemotron-34b\",\n                query: parsedPrompt.query,\n                mediaFile: parsedPrompt.mediaFile,\n                isVideo: parsedPrompt.isVideo,\n                isImage: parsedPrompt.isImage\n            });\n\n            console.log(\"Debug - Network config\", {\n                baseVisionUrl: networkConfig.baseVisionUrl\n            });\n\n            try {\n                // Handle the media file using new Cosmos-specific methods\n                let mediaPath;\n                if (parsedPrompt.isVideo) {\n                    logGranular(\"Processing video file\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        type: 'video'\n                    });\n                    mediaPath = await assetManager.handleVideosCosmos(parsedPrompt.mediaFile);\n                    logGranular(\"Video file processed\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        processedPath: mediaPath\n                    });\n                } else if (parsedPrompt.isImage) {\n                    logGranular(\"Processing image file\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        type: 'image'\n                    });\n                    mediaPath = await assetManager.handleImagesCosmos(parsedPrompt.mediaFile);\n                    logGranular(\"Image file processed\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        processedPath: mediaPath\n                    });\n                } else {\n                    // Use the general handler if type is not specified\n                    const cosmosDir = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos');\n                    logGranular(\"Processing media file using general handler\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        targetDir: cosmosDir\n                    });\n                    mediaPath = await assetManager.handleChatUploadCosmos(parsedPrompt.mediaFile, cosmosDir);\n                    logGranular(\"Media file processed using general handler\", {\n                        originalPath: parsedPrompt.mediaFile,\n                        processedPath: mediaPath\n                    });\n                }\n\n                logGranular(\"Processing file extension\", {\n                    mediaPath,\n                    fullPath: path.resolve(mediaPath)\n                });\n\n                const ext = path.extname(mediaPath).toLowerCase().slice(1) as SupportedExtension;\n                if (!(ext in kSupportedList)) {\n                    const error = `Unsupported file extension: ${ext}`;\n                    logGranular(\"File extension error\", {\n                        ext,\n                        supportedExtensions: Object.keys(kSupportedList)\n                    });\n                    throw new Error(error);\n                }\n\n                logGranular(\"File extension validated\", {\n                    ext,\n                    mimeType: kSupportedList[ext][0],\n                    mediaType: kSupportedList[ext][1]\n                });\n\n                const dataInput = fs.readFileSync(mediaPath);\n                logGranular(\"File read\", {\n                    size: dataInput.length,\n                    mediaPath\n                });\n\n                const description = \"Reference media file\";\n\n                // First API call to authorize asset upload - exact same as nvidia.ts\n                const headers = {\n                    \"Authorization\": `Bearer ${apiKey}`,\n                    \"Content-Type\": \"application/json\",\n                    \"Accept\": \"application/json\"\n                };\n\n                const postData = {\n                    contentType: kSupportedList[ext][0],\n                    description: description\n                };\n\n                logGranular(\"Initiating asset upload authorization\", {\n                    headers: {\n                        ...headers,\n                        \"Authorization\": \"Bearer [REDACTED]\"\n                    },\n                    postData\n                });\n\n                const { data: authorizeRes } = await axios.post(kNvcfAssetUrl, postData, { headers });\n\n                logGranular(\"Asset upload authorized\", {\n                    uploadUrl: authorizeRes.uploadUrl,\n                    assetId: authorizeRes.assetId\n                });\n\n                // Second API call to upload the file - exact same as nvidia.ts\n                const uploadHeaders = {\n                    \"x-amz-meta-nvcf-asset-description\": description,\n                    \"content-type\": kSupportedList[ext][0]\n                };\n\n                logGranular(\"Uploading file to authorized URL\", {\n                    uploadUrl: authorizeRes.uploadUrl,\n                    headers: uploadHeaders,\n                    fileSize: dataInput.length\n                });\n\n                const uploadResponse = await axios.put(authorizeRes.uploadUrl, dataInput, {\n                    headers: uploadHeaders\n                });\n\n                if (uploadResponse.status !== 200) {\n                    const error = `Asset upload failed: ${authorizeRes.assetId}`;\n                    logGranular(\"Upload failed\", {\n                        status: uploadResponse.status,\n                        assetId: authorizeRes.assetId,\n                        response: uploadResponse.data\n                    });\n                    throw new Error(error);\n                }\n\n                const assetId = authorizeRes.assetId;\n                logGranular(\"Asset upload successful\", {\n                    assetId,\n                    status: uploadResponse.status\n                });\n\n                // Construct media content exactly as in nvidia.ts\n                const mediaContent = `<${kSupportedList[ext][1]} src=\"data:${kSupportedList[ext][0]};asset_id,${assetId}\" />`;\n                const promptContent = `${parsedPrompt.query || 'Describe this'} ${mediaContent}`;\n\n                logGranular(\"Constructed media content\", {\n                    mediaContent,\n                    fullPrompt: promptContent\n                });\n\n                const messages = [{\n                    role: \"user\",\n                    content: promptContent\n                }];\n\n                // Headers exactly as in nvidia.ts\n                const inferHeaders = {\n                    \"Authorization\": `Bearer ${apiKey}`,\n                    \"Content-Type\": \"application/json\",\n                    \"Accept\": \"application/json\",\n                    \"NVCF-INPUT-ASSET-REFERENCES\": assetId,\n                    \"NVCF-FUNCTION-ASSET-IDS\": assetId\n                };\n\n                const payload = {\n                    max_tokens: 1024,\n                    temperature: 0.2,\n                    top_p: 0.7,\n                    seed: 50,\n                    num_frames_per_inference: 8,\n                    messages: messages,\n                    stream: false,\n                    model: \"nvidia/vila\"\n                };\n\n                logGranular(\"Preparing Cosmos API request\", {\n                    url: invoke_url,\n                    headers: {\n                        ...inferHeaders,\n                        \"Authorization\": \"Bearer [REDACTED]\"\n                    },\n                    payload: {\n                        ...payload,\n                        messages: messages\n                    }\n                });\n\n                const response = await axios.post(\n                    invoke_url,\n                    payload,\n                    { headers: inferHeaders }\n                );\n\n                logGranular(\"Received Cosmos API response\", {\n                    status: response.status,\n                    headers: response.headers,\n                    data: response.data\n                });\n\n                // Clean up the asset - exact same as nvidia.ts\n                logGranular(\"Initiating asset cleanup\", { assetId });\n\n                await axios.delete(`${kNvcfAssetUrl}/${assetId}`, {\n                    headers: {\n                        \"Authorization\": `Bearer ${apiKey}`\n                    }\n                });\n\n                logGranular(\"Asset cleanup completed\", { assetId });\n\n                const responseText = response.data.choices[0]?.message?.content || \"\";\n                const cosmosResponse = {\n                    ...response.data,\n                    prompt_logprobs: null\n                };\n\n                const analysis: CosmosAnalysis = {\n                    description: responseText,\n                    confidence: 0.92\n                };\n\n                logGranular(\"Processing complete\", {\n                    responseLength: responseText.length,\n                    success: true,\n                    assetId\n                });\n\n                if (callback) {\n                    callback({\n                        text: `Scene Analysis: ${responseText}`,\n                        success: true,\n                        mediaPath,\n                        data: {\n                            response: responseText,\n                            analysis,\n                            raw: cosmosResponse,\n                            assetId\n                        }\n                    } as CosmosContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing media: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        mediaPath: parsedPrompt.mediaFile,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as CosmosContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_COSMOS_DESCRIPTION action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_COSMOS_DESCRIPTION action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getCosmosDescriptionAction;\n\n","import fs from 'fs';\nimport path from 'path';\nimport axios from 'axios';\nimport { MediaType, MediaAsset } from '../types/cosmos.js';\nimport { NimError, NimErrorCode, ErrorSeverity } from '../errors/nimErrors.js';\n\nconst SUPPORTED_FORMATS = {\n    \"png\": [\"image/png\", \"img\"],\n    \"jpg\": [\"image/jpg\", \"img\"],\n    \"jpeg\": [\"image/jpeg\", \"img\"],\n    \"mp4\": [\"video/mp4\", \"video\"]\n} as const;\n\nconst ASSETS_DIR = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos');\nconst NVCF_ASSET_URL = 'https://api.nvcf.nvidia.com/v2/nvcf/assets';\n\nexport class AssetManager {\n    private apiKey: string;\n\n    constructor(apiKey: string) {\n        this.apiKey = apiKey;\n    }\n\n    /**\n     * Get the absolute path to the assets directory\n     */\n    private getAssetsPath(): string {\n        // Try to find the assets directory relative to the current working directory\n        let currentDir = process.cwd();\n        let assetsPath = path.join(currentDir, ASSETS_DIR);\n\n        // If not found, try parent directories\n        while (!fs.existsSync(assetsPath) && currentDir !== path.parse(currentDir).root) {\n            currentDir = path.dirname(currentDir);\n            assetsPath = path.join(currentDir, ASSETS_DIR);\n        }\n\n        if (!fs.existsSync(assetsPath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                \"Assets directory not found\",\n                ErrorSeverity.HIGH\n            );\n        }\n\n        return assetsPath;\n    }\n\n    /**\n     * Get file information\n     */\n    private getFileInfo(filePath: string): { ext: string; mimeType: string; type: MediaType } {\n        const ext = path.extname(filePath).toLowerCase().slice(1);\n        if (!(ext in SUPPORTED_FORMATS)) {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                `Unsupported file format: ${ext}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        const [mimeType, type] = SUPPORTED_FORMATS[ext as keyof typeof SUPPORTED_FORMATS];\n        return { ext, mimeType, type: type as MediaType };\n    }\n\n    /**\n     * Check if a string is a valid URL\n     */\n    private isValidUrl(urlString: string): boolean {\n        try {\n            new URL(urlString);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    /**\n     * Download a file from a URL and save it to the assets directory\n     */\n    async downloadFromUrl(url: string): Promise<string> {\n        if (!this.isValidUrl(url)) {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                \"Invalid URL provided\",\n                ErrorSeverity.HIGH\n            );\n        }\n\n        try {\n            const response = await axios.get(url, {\n                responseType: 'arraybuffer',\n                headers: {\n                    'Accept': Object.values(SUPPORTED_FORMATS).map(([mime]) => mime).join(', ')\n                }\n            });\n\n            const contentType = response.headers['content-type'];\n            const extension = Object.entries(SUPPORTED_FORMATS)\n                .find(([_, [mime]]) => mime === contentType)?.[0];\n\n            if (!extension) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    `Unsupported content type: ${contentType}`,\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            const assetsPath = this.getAssetsPath();\n            const filename = `download_${Date.now()}.${extension}`;\n            const filePath = path.join(assetsPath, filename);\n\n            await fs.promises.writeFile(filePath, response.data);\n            return filename;\n        } catch (error) {\n            if (error instanceof NimError) throw error;\n            throw new NimError(\n                NimErrorCode.DOWNLOAD_ERROR,\n                \"Failed to download media file\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Get or download media file\n     * If the input is a URL, downloads it and returns the local path\n     * If the input is a local file, validates it exists and returns the path\n     */\n    async getOrDownloadMedia(mediaInput: string): Promise<string> {\n        if (this.isValidUrl(mediaInput)) {\n            return this.downloadFromUrl(mediaInput);\n        }\n\n        // If not a URL, treat as local file\n        const assetsPath = this.getAssetsPath();\n        const filePath = path.join(assetsPath, mediaInput);\n\n        if (!fs.existsSync(filePath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Media file not found: ${mediaInput}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        return mediaInput;\n    }\n\n    /**\n     * Upload a media file to NVIDIA's asset service\n     */\n    async uploadAsset(filePath: string, description: string = \"Reference media file\"): Promise<MediaAsset> {\n        const { mimeType, type } = this.getFileInfo(filePath);\n        const fileData = fs.readFileSync(filePath);\n\n        // First API call to authorize asset upload\n        const headers = {\n            \"Authorization\": `Bearer ${this.apiKey}`,\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\"\n        };\n\n        try {\n            // Get upload URL\n            const { data: authorizeRes } = await axios.post(NVCF_ASSET_URL, {\n                contentType: mimeType,\n                description\n            }, { headers });\n\n            // Upload the file\n            await axios.put(authorizeRes.uploadUrl, fileData, {\n                headers: {\n                    \"x-amz-meta-nvcf-asset-description\": description,\n                    \"content-type\": mimeType\n                }\n            });\n\n            return {\n                assetId: authorizeRes.assetId,\n                type,\n                mimeType,\n                description\n            };\n        } catch (error) {\n            throw new NimError(\n                NimErrorCode.API_ERROR,\n                \"Failed to upload asset\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Delete an asset from NVIDIA's service\n     */\n    async deleteAsset(assetId: string): Promise<void> {\n        try {\n            await axios.delete(`${NVCF_ASSET_URL}/${assetId}`, {\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n        } catch (error) {\n            throw new NimError(\n                NimErrorCode.API_ERROR,\n                \"Failed to delete asset\",\n                ErrorSeverity.LOW,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Get a list of available media files in the assets directory\n     */\n    listAvailableMedia(): string[] {\n        const assetsPath = this.getAssetsPath();\n        return fs.readdirSync(assetsPath)\n            .filter(file => {\n                const ext = path.extname(file).toLowerCase().slice(1);\n                return ext in SUPPORTED_FORMATS;\n            })\n            .map(file => path.join(assetsPath, file));\n    }\n\n    /**\n     * Get the full path to a media file in the assets directory\n     */\n    getMediaPath(filename: string): string {\n        const assetsPath = this.getAssetsPath();\n        const filePath = path.join(assetsPath, filename);\n\n        if (!fs.existsSync(filePath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Media file not found: ${filename}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        return filePath;\n    }\n\n    /**\n     * Handle a file uploaded through chat\n     * This will copy the file to the appropriate assets directory and return the new path\n     */\n    async handleChatUpload(uploadPath: string, targetDir: string): Promise<string> {\n        if (!fs.existsSync(uploadPath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Upload file not found: ${uploadPath}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        console.log(\"Debug - AssetManager - Input paths:\", {\n            uploadPath,\n            targetDir,\n            cwd: process.cwd()\n        });\n\n        // Find workspace root\n        let workspaceRoot = process.cwd().replace('/agent', '');\n        while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n            workspaceRoot = path.dirname(workspaceRoot);\n        }\n\n        // Convert targetDir to absolute path if it's relative\n        const absoluteTargetDir = path.isAbsolute(targetDir)\n            ? targetDir\n            : path.join(workspaceRoot, targetDir);\n\n        console.log(\"Debug - AssetManager - Resolved paths:\", {\n            workspaceRoot,\n            absoluteTargetDir\n        });\n\n        // Ensure target directory exists\n        if (!fs.existsSync(absoluteTargetDir)) {\n            fs.mkdirSync(absoluteTargetDir, { recursive: true });\n        }\n\n        // Generate a new filename with timestamp\n        const ext = path.extname(uploadPath);\n        const timestamp = Date.now();\n        const newFilename = `upload_${timestamp}${ext}`;\n        const newPath = path.join(absoluteTargetDir, newFilename);\n\n        console.log(\"Debug - AssetManager - File paths:\", {\n            newFilename,\n            newPath,\n            exists: fs.existsSync(uploadPath)\n        });\n\n        // Copy the file\n        try {\n            await fs.promises.copyFile(uploadPath, newPath);\n            console.log(\"Debug - AssetManager - File copied successfully:\", {\n                from: uploadPath,\n                to: newPath\n            });\n            return newPath;\n        } catch (error) {\n            throw new NimError(\n                NimErrorCode.FILE_OPERATION_FAILED,\n                `Failed to copy upload file: ${error instanceof Error ? error.message : String(error)}`,\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Handle image files for Cosmos\n     * This includes validation, copying, and path management specific to Cosmos images\n     */\n    async handleImagesCosmos(uploadPath: string): Promise<string> {\n        console.log(\"Debug - AssetManager - Handling Cosmos image:\", {\n            uploadPath,\n            type: 'image'\n        });\n\n        // Find workspace root\n        let workspaceRoot = process.cwd().replace('/agent', '');\n        while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n            workspaceRoot = path.dirname(workspaceRoot);\n        }\n\n        // Set up Cosmos image directory\n        const cosmosImageDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos', 'images');\n        const cosmosTempDir = path.join(cosmosImageDir, 'temp');\n\n        // Ensure directories exist\n        if (!fs.existsSync(cosmosImageDir)) {\n            fs.mkdirSync(cosmosImageDir, { recursive: true });\n        }\n        if (!fs.existsSync(cosmosTempDir)) {\n            fs.mkdirSync(cosmosTempDir, { recursive: true });\n        }\n\n        // Validate file exists and is an image\n        if (!fs.existsSync(uploadPath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Image file not found: ${uploadPath}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        const ext = path.extname(uploadPath).toLowerCase();\n        if (!['.jpg', '.jpeg', '.png', '.gif'].includes(ext)) {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                `Invalid image format: ${ext}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        // Generate new filename and copy file\n        const timestamp = Date.now();\n        const newFilename = `cosmos_img_${timestamp}${ext}`;\n        const newPath = path.join(cosmosImageDir, newFilename);\n\n        try {\n            await fs.promises.copyFile(uploadPath, newPath);\n            console.log(\"Debug - AssetManager - Cosmos image processed:\", {\n                from: uploadPath,\n                to: newPath,\n                size: fs.statSync(newPath).size\n            });\n            return newPath;\n        } catch (error) {\n            throw new NimError(\n                NimErrorCode.FILE_OPERATION_FAILED,\n                `Failed to process Cosmos image: ${error instanceof Error ? error.message : String(error)}`,\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Handle video files for Cosmos\n     * This includes validation, copying, and path management specific to Cosmos videos\n     */\n    async handleVideosCosmos(uploadPath: string): Promise<string> {\n        console.log(\"Debug - AssetManager - Handling Cosmos video:\", {\n            uploadPath,\n            type: 'video'\n        });\n\n        // Find workspace root\n        let workspaceRoot = process.cwd().replace('/agent', '');\n        while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n            workspaceRoot = path.dirname(workspaceRoot);\n        }\n\n        // Set up Cosmos video directory\n        const cosmosVideoDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos', 'videos');\n        const cosmosTempDir = path.join(cosmosVideoDir, 'temp');\n\n        // Ensure directories exist\n        if (!fs.existsSync(cosmosVideoDir)) {\n            fs.mkdirSync(cosmosVideoDir, { recursive: true });\n        }\n        if (!fs.existsSync(cosmosTempDir)) {\n            fs.mkdirSync(cosmosTempDir, { recursive: true });\n        }\n\n        // Validate file exists and is a video\n        if (!fs.existsSync(uploadPath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Video file not found: ${uploadPath}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        const ext = path.extname(uploadPath).toLowerCase();\n        if (!['.mp4', '.avi', '.mov', '.webm'].includes(ext)) {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                `Invalid video format: ${ext}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        // Generate new filename and copy file\n        const timestamp = Date.now();\n        const newFilename = `cosmos_vid_${timestamp}${ext}`;\n        const newPath = path.join(cosmosVideoDir, newFilename);\n\n        try {\n            await fs.promises.copyFile(uploadPath, newPath);\n            console.log(\"Debug - AssetManager - Cosmos video processed:\", {\n                from: uploadPath,\n                to: newPath,\n                size: fs.statSync(newPath).size\n            });\n            return newPath;\n        } catch (error) {\n            throw new NimError(\n                NimErrorCode.FILE_OPERATION_FAILED,\n                `Failed to process Cosmos video: ${error instanceof Error ? error.message : String(error)}`,\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n\n    /**\n     * Updated handleChatUploadCosmos to use the new specialized handlers\n     */\n    async handleChatUploadCosmos(uploadPath: string, targetDir: string): Promise<string> {\n        if (!fs.existsSync(uploadPath)) {\n            throw new NimError(\n                NimErrorCode.FILE_NOT_FOUND,\n                `Upload file not found: ${uploadPath}`,\n                ErrorSeverity.HIGH\n            );\n        }\n\n        // Determine file type\n        const ext = path.extname(uploadPath).toLowerCase();\n        const isVideo = ['.mp4', '.avi', '.mov', '.webm'].includes(ext);\n        const isImage = ['.jpg', '.jpeg', '.png', '.gif'].includes(ext);\n\n        console.log(\"Debug - AssetManager - Cosmos upload type:\", {\n            path: uploadPath,\n            extension: ext,\n            isVideo,\n            isImage\n        });\n\n        // Handle based on file type\n        if (isVideo) {\n            return this.handleVideosCosmos(uploadPath);\n        } else if (isImage) {\n            return this.handleImagesCosmos(uploadPath);\n        } else {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                `Unsupported file type: ${ext}`,\n                ErrorSeverity.HIGH\n            );\n        }\n    }\n}","import { Media } from \"@elizaos/core\";\nimport { AssetManager } from \"./assetManager.js\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\nimport path from 'path';\nimport process from 'process';\nimport fs from 'fs';\n\n// Debug logging helper\nconst debugLog = (message: string, data?: unknown) => {\n    console.log(`Debug - Cosmos Parser - ${message}:`, data);\n};\n\nexport interface CosmosParsedPrompt {\n    mediaFile?: string;\n    query?: string;\n    isVideo: boolean;\n    isImage: boolean;\n    isBase64: boolean;\n}\n\n/**\n * Parse a prompt for Cosmos Vision processing\n * Supports both traditional [MEDIA]...[/MEDIA] format and direct file uploads\n */\nexport const parseCosmosPrompt = async (text?: string, attachments?: Media[], apiKey?: string): Promise<CosmosParsedPrompt> => {\n    debugLog(\"Input\", {\n        hasText: !!text,\n        textLength: text?.length,\n        attachmentCount: attachments?.length,\n        hasApiKey: !!apiKey\n    });\n\n    const result: CosmosParsedPrompt = {\n        isVideo: false,\n        isImage: false,\n        isBase64: false\n    };\n\n    // Get workspace root using the same logic as actionGetDeepFake.ts\n    let workspaceRoot = process.cwd().replace('/agent', '');\n    while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n        workspaceRoot = path.dirname(workspaceRoot);\n    }\n\n    debugLog(\"Workspace paths\", {\n        cwd: process.cwd(),\n        workspaceRoot,\n        hasPackagesDir: fs.existsSync(path.join(workspaceRoot, 'packages'))\n    });\n\n    if (!text && !attachments?.length) {\n        return result;\n    }\n\n    // Handle direct file uploads first\n    if (attachments?.length) {\n        const firstAttachment = attachments[0];\n        debugLog(\"First attachment\", {\n            id: firstAttachment.id,\n            contentType: firstAttachment.contentType,\n            url: firstAttachment.url\n        });\n\n        // Determine media type from content type\n        const contentType = firstAttachment.contentType || '';\n        const isVideo = contentType.startsWith('video/');\n        const isImage = contentType.startsWith('image/');\n\n        if (!isVideo && !isImage) {\n            throw new NimError(\n                NimErrorCode.VALIDATION_FAILED,\n                \"Unsupported media type. Only images and videos are supported.\",\n                ErrorSeverity.HIGH\n            );\n        }\n\n        // Use AssetManager to handle the upload\n        if (apiKey) {\n            const assetManager = new AssetManager(apiKey);\n            const uploadPath = firstAttachment.url;\n            const cosmosDir = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos');\n            const fullCosmosDir = path.join(workspaceRoot, cosmosDir);\n\n            debugLog(\"Upload paths\", {\n                uploadPath,\n                cosmosDir,\n                fullCosmosDir\n            });\n\n            try {\n                const newPath = await assetManager.handleChatUploadCosmos(uploadPath, cosmosDir);\n                result.mediaFile = path.basename(newPath);\n                result.isVideo = isVideo;\n                result.isImage = isImage;\n                result.isBase64 = false;\n\n                debugLog(\"Upload result\", {\n                    newPath,\n                    mediaFile: result.mediaFile\n                });\n            } catch (error) {\n                throw new NimError(\n                    NimErrorCode.FILE_OPERATION_FAILED,\n                    `Failed to process uploaded file: ${error instanceof Error ? error.message : String(error)}`,\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        }\n\n        // Extract query from text if present\n        if (text) {\n            const queryMatch = text.match(/\\[QUERY\\](.*?)\\[\\/QUERY\\]/s);\n            result.query = queryMatch ? queryMatch[1].trim() : text.trim();\n        }\n\n        return result;\n    }\n\n    // Handle text-based prompt with [MEDIA]...[/MEDIA] tags\n    if (text) {\n        const mediaMatch = text.match(/\\[MEDIA\\](.*?)\\[\\/MEDIA\\]/s);\n        const queryMatch = text.match(/\\[QUERY\\](.*?)\\[\\/QUERY\\]/s);\n\n        debugLog(\"Text matches\", {\n            hasMediaMatch: !!mediaMatch,\n            hasQueryMatch: !!queryMatch,\n            mediaContent: mediaMatch?.[1]?.trim(),\n            queryContent: queryMatch?.[1]?.trim()\n        });\n\n        if (mediaMatch) {\n            const mediaFile = mediaMatch[1].trim();\n            // Build the correct path for local files\n            const cosmosDir = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'cosmos');\n            const fullCosmosDir = path.join(workspaceRoot, cosmosDir);\n            const mediaPath = path.join(fullCosmosDir, mediaFile);\n\n            debugLog(\"Local file paths\", {\n                mediaFile,\n                cosmosDir,\n                fullCosmosDir,\n                mediaPath\n            });\n\n            result.mediaFile = mediaPath;\n\n            // Determine file type\n            const ext = path.extname(mediaFile).toLowerCase();\n            result.isVideo = ['.mp4', '.mov', '.avi', '.webm'].includes(ext);\n            result.isImage = ['.jpg', '.jpeg', '.png', '.gif', '.webp'].includes(ext);\n        }\n\n        if (queryMatch) {\n            result.query = queryMatch[1].trim();\n        }\n    }\n\n    debugLog(\"Result\", {\n        hasMediaFile: !!result.mediaFile,\n        isVideo: result.isVideo,\n        isImage: result.isImage,\n        isBase64: result.isBase64,\n        hasQuery: !!result.query,\n        fullPath: result.mediaFile\n    });\n\n    return result;\n}\n\n/**\n * Creates a formatted Cosmos prompt string\n */\nexport function createCosmosPrompt(mediaFile: string, query: string = \"Describe the scene\"): string {\n    return `[MEDIA]\n${mediaFile}\n[/MEDIA]\n[QUERY]\n${query}\n[/QUERY]`;\n}","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample, Media } from \"@elizaos/core\";\nimport axios from 'axios';\nimport fs from 'fs';\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.js\";\nimport { parseDeepFakePrompt } from \"../utils/deepfakePromptParser.js\";\nimport { DeepFakeContent, DeepFakeResponse, DeepFakeAnalysis } from \"../types/deepfake.js\";\nimport { AssetManager } from \"../utils/assetManager.js\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\nimport path from 'path';\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[DeepFakeDetection] ${message}`, data);\n        console.log(`[DeepFakeDetection] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n\ninterface ApiHeaders {\n    Authorization: string;\n    Accept: string;\n    'Content-Type'?: string;\n    'NVCF-INPUT-ASSET-REFERENCES'?: string;\n    [key: string]: string | undefined;\n}\n\nexport const getDeepFakeAction: Action = {\n    name: \"GET_DEEP_FAKE\",\n    similes: [\"CHECK_DEEP_FAKE\", \"ANALYZE_DEEP_FAKE\", \"DEEP_FAKE_CONTROL\"],\n    description: \"Use NVIDIA DeepFake detection model to analyze images for potential manipulation\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Check if this image is a deepfake please[IMAGE]\\ntest_image.jpg\\n[/IMAGE]\",\n                mediaPath: \"test_image.jpg\"\n            } as DeepFakeContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"DeepFake Analysis: Image contains 1 face(s). Face #1: 99.82% likely to be a deepfake.\",\n                success: true,\n                data: {\n                    response: \"Detected potential manipulation in the image\",\n                    analysis: [{\n                        index: 0,\n                        bounding_boxes: [{\n                            vertices: [\n                                { x: 167.92, y: 105.52 },\n                                { x: 327.76, y: 327.61 }\n                            ],\n                            bbox_confidence: 0.9352,\n                            is_deepfake: 0.9982\n                        }],\n                        status: \"SUCCESS\"\n                    }]\n                }\n            } as DeepFakeContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_DEEP_FAKE\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_DEEP_FAKE action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as DeepFakeContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_DEEP_FAKE\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_DEEPFAKE action\");\n\n        try {\n            const messageContent = message.content as DeepFakeContent;\n            console.log(\"Debug - Full message content:\", {\n                fullContent: message.content,\n                rawText: messageContent?.text,\n                type: message.content?.type,\n                allKeys: Object.keys(message.content || {}),\n                attachments: message.content?.attachments\n            });\n\n            console.log(\"Debug - Message content details:\", {\n                hasText: !!messageContent?.text,\n                hasMediaFile: !!messageContent?.mediaFile,\n                hasAttachments: !!message.content?.attachments?.length,\n                textContent: messageContent?.text,\n                mediaFile: messageContent?.mediaFile,\n                contentType: typeof messageContent?.text,\n                attachmentCount: message.content?.attachments?.length || 0,\n                firstAttachmentUrl: message.content?.attachments?.[0]?.url,\n                firstAttachmentType: message.content?.attachments?.[0]?.contentType\n            });\n\n            const config = await validateNvidiaNimConfig(runtime);\n            console.log(\"Debug - Config validated:\", {\n                hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n                env: config.NVIDIA_NIM_ENV\n            });\n\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            console.log(\"Debug - Network config:\", {\n                hasBaseUrl: !!networkConfig?.baseUrl,\n                baseUrl: networkConfig?.baseUrl\n            });\n\n            // Parse the prompt using our helper\n            console.log(\"Debug - Raw prompt:\", {\n                text: messageContent.text,\n                hasMediaFile: !!messageContent.mediaFile,\n                mediaFile: messageContent.mediaFile,\n                promptLength: messageContent.text?.length,\n                attachments: message.content?.attachments\n            });\n\n            const parsedPrompt = await parseDeepFakePrompt(\n                messageContent.text,\n                message.content?.attachments,\n                config.NVIDIA_NIM_API_KEY\n            );\n            console.log(\"Debug - Parsed content:\", {\n                hasMediaFile: !!parsedPrompt.mediaFile,\n                mediaPath: parsedPrompt.mediaFile,\n                mediaLength: parsedPrompt.mediaFile?.length,\n                isBase64: parsedPrompt.isBase64\n            });\n\n            let imageB64: string;\n            let fileData: Buffer;\n            let mediaPath: string = '';\n            let workspaceRoot: string;\n            let deepfakeDir: string;\n\n            if (parsedPrompt.isBase64) {\n                // Image is already in base64 format from chat\n                console.log(\"Debug - Using base64 image from chat\");\n                imageB64 = parsedPrompt.mediaFile.split('base64,')[1]; // Remove the data:image/jpeg;base64, prefix\n                fileData = Buffer.from(imageB64, 'base64');\n\n                // Set up paths for potential temp file storage\n                workspaceRoot = process.cwd().replace('/agent', '');\n                while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n                    workspaceRoot = path.dirname(workspaceRoot);\n                }\n                deepfakeDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'deepfake');\n\n                // Create temp file for base64 image\n                const tempDir = path.join(deepfakeDir, 'temp');\n                if (!fs.existsSync(tempDir)) {\n                    fs.mkdirSync(tempDir, { recursive: true });\n                }\n                mediaPath = path.join(tempDir, `temp_${Date.now()}.jpg`);\n                fs.writeFileSync(mediaPath, fileData);\n            } else {\n                // Image is a file path\n                // Find the workspace root by looking for packages directory\n                // workspaceRoot = process.cwd();\n                workspaceRoot = process.cwd().replace('/agent', '');\n                while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n                    workspaceRoot = path.dirname(workspaceRoot);\n                }\n\n                console.log(\"Debug - Workspace detection:\", {\n                    workspaceRoot,\n                    hasPackagesDir: fs.existsSync(path.join(workspaceRoot, 'packages'))\n                });\n\n                deepfakeDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'deepfake');\n                mediaPath = path.join(deepfakeDir, parsedPrompt.mediaFile);\n                const absolutePath = path.resolve(mediaPath);\n\n                console.log(\"Debug - File paths:\", {\n                    workspaceRoot,\n                    deepfakeDir,\n                    mediaPath,\n                    absolutePath,\n                    cwd: process.cwd(),\n                    exists: fs.existsSync(mediaPath),\n                    dirExists: fs.existsSync(deepfakeDir)\n                });\n\n                // Ensure deepfake directory exists\n                if (!fs.existsSync(deepfakeDir)) {\n                    console.log(\"Debug - Creating deepfake directory\");\n                    fs.mkdirSync(deepfakeDir, { recursive: true });\n                }\n\n                // Test file access\n                try {\n                    await fs.promises.access(mediaPath, fs.constants.R_OK);\n                    console.log(\"Debug - File is readable at path:\", mediaPath);\n\n                    const stats = await fs.promises.stat(mediaPath);\n                    console.log(\"Debug - File stats:\", {\n                        size: stats.size,\n                        isFile: stats.isFile(),\n                        permissions: stats.mode\n                    });\n                } catch (error) {\n                    console.error(\"Debug - File access error:\", {\n                        error: error instanceof Error ? error.message : String(error),\n                        path: mediaPath\n                    });\n                }\n\n                // Ensure the file exists\n                if (!fs.existsSync(mediaPath)) {\n                    console.error(`Media file not found: ${mediaPath}`);\n                    // Try listing directory contents\n                    try {\n                        const dirContents = await fs.promises.readdir(path.dirname(mediaPath));\n                        console.log(\"Debug - Directory contents:\", {\n                            path: path.dirname(mediaPath),\n                            files: dirContents\n                        });\n                    } catch (dirError) {\n                        console.error(\"Debug - Failed to read directory:\", dirError);\n                    }\n                    throw new NimError(\n                        NimErrorCode.FILE_NOT_FOUND,\n                        `Media file not found: ${mediaPath}`,\n                        ErrorSeverity.HIGH\n                    );\n                }\n\n                // Read the file\n                console.log(\"Debug - Reading file from path\");\n                fileData = fs.readFileSync(mediaPath);\n                imageB64 = fileData.toString('base64');\n            }\n\n            // ------------------------------------------------------------------------------------------------\n            // Core DeepFake detection logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"hive/deepfake-image-detection\",\n                hasMediaFile: true,\n                imageSize: fileData.length,\n                isBase64Image: parsedPrompt.isBase64\n            });\n\n            try {\n                let payload;\n                let headers: ApiHeaders = {\n                    \"Authorization\": `Bearer ${config.NVIDIA_NIM_API_KEY}`,\n                    \"Accept\": \"application/json\"\n                };\n\n                // Handle large files through asset upload\n                if (imageB64.length < 180000) {\n                    payload = {\n                        input: [`data:image/jpeg;base64,${imageB64}`]\n                    };\n                    headers[\"Content-Type\"] = \"application/json\";\n                } else {\n                    // For base64 images from chat, we need to save them first\n                    let tempPath: string | null = null;\n                    let uploadPath = mediaPath;\n                    //let uploadPath = path.join(workspaceRoot, mediaPath);\n\n                    if (parsedPrompt.isBase64) {\n                        const tempDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'deepfake', 'temp');\n                        if (!fs.existsSync(tempDir)) {\n                            fs.mkdirSync(tempDir, { recursive: true });\n                        }\n                        tempPath = path.join(tempDir, `temp_${Date.now()}_large.jpg`);\n                        fs.writeFileSync(tempPath, fileData);\n                        uploadPath = tempPath;\n                    }\n\n                    // Upload the file and get the asset ID\n                    const assetManager = new AssetManager(config.NVIDIA_NIM_API_KEY);\n                    const uploadedAsset = await assetManager.uploadAsset(uploadPath);\n\n                    // Clean up temp file if we created one\n                    if (tempPath && fs.existsSync(tempPath)) {\n                        fs.unlinkSync(tempPath);\n                    }\n\n                    payload = {\n                        input: [`data:image/jpeg;asset_id,${uploadedAsset.assetId}`]\n                    };\n                    headers[\"Content-Type\"] = \"application/json\";\n                    headers[\"NVCF-INPUT-ASSET-REFERENCES\"] = uploadedAsset.assetId;\n                }\n\n                // Make the API request\n                const apiUrl = 'https://ai.api.nvidia.com/v1/cv/hive/deepfake-image-detection';\n                console.log(\"Debug - Making API request:\", {\n                    url: apiUrl,\n                    payloadSize: JSON.stringify(payload).length,\n                    hasAuth: !!headers.Authorization\n                });\n\n                const { data: response } = await axios.post(\n                    apiUrl,\n                    payload,\n                    {\n                        headers,\n                        maxBodyLength: Infinity,\n                        maxContentLength: Infinity\n                    }\n                );\n\n                console.log(\"Debug - API Response received:\", {\n                    status: 'success',\n                    dataLength: JSON.stringify(response).length\n                });\n\n                const deepfakeResponse = response as DeepFakeResponse;\n\n                logGranular(\"Successfully received response from NVIDIA NIM\", {\n                    response: deepfakeResponse\n                });\n\n                // Process the analysis results\n                const analysis: DeepFakeAnalysis = deepfakeResponse.data[0];\n\n                logGranular(\"Processing analysis results\", {\n                    analysis\n                });\n\n                // Save the processed image if available\n                let processedImagePath = '';\n                if (analysis.image) {\n                    const filename = `df_analysis_${Date.now()}.jpg`;\n                    processedImagePath = path.join(deepfakeDir, filename);\n\n                    // Ensure deepfake directory exists\n                    if (!fs.existsSync(path.dirname(processedImagePath))) {\n                        fs.mkdirSync(path.dirname(processedImagePath), { recursive: true });\n                    }\n\n                    // Convert base64 to image and save\n                    const imageBuffer = Buffer.from(analysis.image.split(',')[1], 'base64');\n                    fs.writeFileSync(processedImagePath, imageBuffer);\n\n                    logGranular(\"Saved processed image\", {\n                        path: processedImagePath\n                    });\n                }\n\n                const faceCount = analysis.bounding_boxes.length;\n                const faceDescriptions = analysis.bounding_boxes.map((box, idx) =>\n                    `Face #${idx + 1}: ${(box.is_deepfake * 100).toFixed(2)}% likely to be a deepfake`\n                );\n\n                const analysisText = `DeepFake Analysis: Image contains ${faceCount} face(s). ${faceDescriptions.join(\". \")}${\n                    processedImagePath ? `\\n\\nProcessed image saved to: ${processedImagePath}` : ''\n                }`;\n\n                const processedData = {\n                    response: \"Analyzed image for potential manipulation\",\n                    analysis: [analysis],\n                    processedImage: processedImagePath || null\n                };\n\n                if (callback) {\n                    callback({\n                        text: analysisText,\n                        success: true,\n                        mediaPath,\n                        data: processedData\n                    } as DeepFakeContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing image: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        mediaPath: parsedPrompt.mediaFile,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as DeepFakeContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_DEEP_FAKE action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_DEEP_FAKE action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getDeepFakeAction;\n\n","import { Media } from \"@elizaos/core\";\nimport { AssetManager } from \"./assetManager.js\";\nimport path from 'path';\n\ninterface DeepFakeParsedPrompt {\n    mediaFile: string;\n    isBase64: boolean;\n}\n\ninterface MessageAttachment {\n    data: string;\n    type: string;\n    name?: string;\n}\n\n/**\n * Parses a prompt string to extract the media file for deepfake detection\n * Format expected either:\n * [IMAGE]\n * path/to/image/file\n * [/IMAGE]\n *\n * or\n *\n * [IMAGE]\n * data:image/jpeg;base64,...\n * [/IMAGE]\n *\n * or directly from message attachments\n */\nexport async function parseDeepFakePrompt(text: string, attachments?: Media[], apiKey?: string): Promise<DeepFakeParsedPrompt> {\n    // First check for attachments\n    if (attachments && attachments.length > 0) {\n        const imageAttachment = attachments[0];\n        if (!imageAttachment.url) {\n            throw new Error(\"Invalid media attachment: no URL found\");\n        }\n\n        // Handle the uploaded file\n        if (apiKey) {\n            const assetManager = new AssetManager(apiKey);\n            const deepfakeDir = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'deepfake');\n            const newPath = await assetManager.handleChatUpload(imageAttachment.url, deepfakeDir);\n\n            return {\n                mediaFile: path.basename(newPath),\n                isBase64: false\n            };\n        }\n\n        return {\n            mediaFile: imageAttachment.url,\n            isBase64: imageAttachment.url.startsWith('data:image')\n        };\n    }\n\n    // If no attachments, try to parse from text\n    const mediaMatch = text.match(/\\[IMAGE\\]([\\s\\S]*?)\\[\\/IMAGE\\]/);\n\n    if (!mediaMatch) {\n        throw new Error(\"Image file path or data is required\");\n    }\n\n    const mediaContent = mediaMatch[1].trim();\n    const isBase64 = mediaContent.startsWith('data:image');\n\n    return {\n        mediaFile: mediaContent,\n        isBase64\n    };\n}\n\n/**\n * Creates a formatted deepfake detection prompt string\n */\nexport function createDeepFakePrompt(mediaFile: string): string {\n    return `[IMAGE]\n${mediaFile}\n[/IMAGE]`;\n}","import { Media } from \"@elizaos/core\";\nimport { AssetManager } from \"./assetManager.js\";\nimport path from 'path';\n\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\n\ninterface ParsedAIImagePrompt {\n    mediaFile: string;\n    isBase64: boolean;\n}\n\n/**\n * Parses a prompt string to extract the media file for AI image analysis\n * Format expected either:\n * [IMAGE]\n * path/to/image/file\n * [/IMAGE]\n *\n * or\n *\n * [IMAGE]\n * data:image/jpeg;base64,...\n * [/IMAGE]\n *\n * or directly from message attachments\n */\nexport async function parseAIImagePrompt(text: string, attachments?: Media[], apiKey?: string): Promise<ParsedAIImagePrompt> {\n    try {\n        // First check for attachments\n        if (attachments && attachments.length > 0) {\n            const imageAttachment = attachments[0];\n            if (!imageAttachment.url) {\n                throw new Error(\"Invalid media attachment: no URL found\");\n            }\n\n            // Handle the uploaded file\n            if (apiKey) {\n                const assetManager = new AssetManager(apiKey);\n                const aiImageDir = path.join('packages', 'plugin-nvidia-nim', 'src', 'assets', 'aiimage');\n                const newPath = await assetManager.handleChatUpload(imageAttachment.url, aiImageDir);\n\n                return {\n                    mediaFile: path.basename(newPath),\n                    isBase64: false\n                };\n            }\n\n            return {\n                mediaFile: imageAttachment.url,\n                isBase64: imageAttachment.url.startsWith('data:image')\n            };\n        }\n\n        // If no attachments, try to parse from text\n        const mediaMatch = text.match(/\\[IMAGE\\]([\\s\\S]*?)\\[\\/IMAGE\\]/);\n\n        if (!mediaMatch) {\n            throw new Error(\"Image file path or data is required\");\n        }\n\n        const mediaContent = mediaMatch[1].trim();\n        const isBase64 = mediaContent.startsWith('data:image');\n\n        return {\n            mediaFile: mediaContent,\n            isBase64\n        };\n    } catch (error) {\n        if (error instanceof NimError) {\n            throw error;\n        }\n        throw new NimError(\n            NimErrorCode.PARSE_ERROR,\n            \"Failed to parse AI image prompt\",\n            ErrorSeverity.HIGH,\n            { originalError: error }\n        );\n    }\n}\n\n/**\n * Creates a formatted AI image analysis prompt string\n */\nexport function createAIImagePrompt(mediaFile: string): string {\n    return `[IMAGE]\n${mediaFile}\n[/IMAGE]`;\n}","import { Action, elizaLogger } from \"@elizaos/core\";\nimport { IAgentRuntime, Memory, State, HandlerCallback, ActionExample, Media } from \"@elizaos/core\";\nimport axios from 'axios';\nimport fs from 'fs';\nimport { validateNvidiaNimConfig, getNetworkConfig, getConfig } from \"../environment.js\";\nimport { parseAIImagePrompt } from \"../utils/aiImagePromptParser.js\";\nimport { AIImageContent, AIImageResponse, AIImageAnalysis } from \"../types/aiImage.js\";\nimport { AssetManager } from \"../utils/assetManager.js\";\nimport { NimError, NimErrorCode, ErrorSeverity } from \"../errors/nimErrors.js\";\nimport path from 'path';\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.NVIDIA_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n    if (GRANULAR_LOG) {\n        elizaLogger.info(`[AIImageDetection] ${message}`, data);\n        console.log(`[AIImageDetection] ${message}`, data ? JSON.stringify(data, null, 2) : '');\n    }\n};\n\ninterface ApiHeaders {\n    Authorization: string;\n    Accept: string;\n    'Content-Type'?: string;\n    'NVCF-INPUT-ASSET-REFERENCES'?: string;\n    [key: string]: string | undefined;\n}\n\nexport const getAIImageAction: Action = {\n    name: \"GET_AI_IMAGE\",\n    similes: [\"CHECK_AI_IMAGE\", \"ANALYZE_AI_IMAGE\", \"AI_IMAGE_CONTROL\"],\n    description: \"Use NVIDIA AI Image detection model to analyze if images were generated by AI\",\n    examples: [[\n        {\n            user: \"user\",\n            content: {\n                text: \"Check if this image is AI generated [IMAGE]\\ntest_ai.jpg\\n[/IMAGE]  \",\n                mediaPath: \"test_ai.jpg\"\n            } as AIImageContent\n        } as ActionExample,\n        {\n            user: \"assistant\",\n            content: {\n                text: \"AI Image Analysis: Image is 99.94% likely to be AI-generated. Most likely source: Stable Diffusion XL (88.75% confidence).\",\n                success: true,\n                data: {\n                    response: \"Detected AI-generated image\",\n                    analysis: [{\n                        index: 0,\n                        is_ai_generated: 0.9994,\n                        possible_sources: {\n                            stablediffusionxl: 0.8875,\n                            midjourney: 0.0136,\n                            dalle: 0.0518,\n                        },\n                        status: \"SUCCESS\"\n                    }]\n                }\n            } as AIImageContent\n        } as ActionExample\n    ]],\n\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\n        if (message.content?.type !== \"GET_AI_IMAGE\") {\n            return true;\n        }\n\n        logGranular(\"Validating GET_AI_IMAGE action\", {\n            content: message.content\n        });\n\n        try {\n            const content = message.content as AIImageContent;\n\n            if (!content.text) {\n                throw new NimError(\n                    NimErrorCode.VALIDATION_FAILED,\n                    \"text content is required\",\n                    ErrorSeverity.HIGH\n                );\n            }\n\n            return true;\n        } catch (error) {\n            logGranular(\"Validation failed\", { error });\n            elizaLogger.error(\"Validation failed for GET_AI_IMAGE\", {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            return false;\n        }\n    },\n\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State,\n        _options: { [key: string]: unknown } = {},\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        logGranular(\"Executing GET_AI_IMAGE action\");\n\n        try {\n            const messageContent = message.content as AIImageContent;\n            console.log(\"Debug - Full message content:\", {\n                fullContent: message.content,\n                rawText: messageContent?.text,\n                type: message.content?.type,\n                allKeys: Object.keys(message.content || {}),\n                attachments: message.content?.attachments\n            });\n\n            console.log(\"Debug - Message content details:\", {\n                hasText: !!messageContent?.text,\n                hasMediaFile: !!messageContent?.mediaFile,\n                hasAttachments: !!message.content?.attachments?.length,\n                textContent: messageContent?.text,\n                mediaFile: messageContent?.mediaFile,\n                contentType: typeof messageContent?.text,\n                attachmentCount: message.content?.attachments?.length || 0,\n                firstAttachmentUrl: message.content?.attachments?.[0]?.url,\n                firstAttachmentType: message.content?.attachments?.[0]?.contentType\n            });\n\n            const config = await validateNvidiaNimConfig(runtime);\n            console.log(\"Debug - Config validated:\", {\n                hasApiKey: !!config.NVIDIA_NIM_API_KEY,\n                env: config.NVIDIA_NIM_ENV\n            });\n\n            const networkConfig = getNetworkConfig(config.NVIDIA_NIM_ENV);\n            console.log(\"Debug - Network config:\", {\n                hasBaseUrl: !!networkConfig?.baseUrl,\n                baseUrl: networkConfig?.baseUrl\n            });\n\n            // Parse the prompt using our helper\n            console.log(\"Debug - Raw prompt:\", {\n                text: messageContent.text,\n                hasMediaFile: !!messageContent.mediaFile,\n                mediaFile: messageContent.mediaFile,\n                promptLength: messageContent.text?.length,\n                attachments: message.content?.attachments\n            });\n\n            const parsedPrompt = await parseAIImagePrompt(\n                messageContent.text,\n                message.content?.attachments,\n                config.NVIDIA_NIM_API_KEY\n            );\n            console.log(\"Debug - Parsed content:\", {\n                hasMediaFile: !!parsedPrompt.mediaFile,\n                mediaPath: parsedPrompt.mediaFile,\n                mediaLength: parsedPrompt.mediaFile?.length,\n                isBase64: parsedPrompt.isBase64\n            });\n\n            let imageB64: string;\n            let fileData: Buffer;\n            let mediaPath: string = '';\n            let workspaceRoot: string;\n            let aiImageDir: string;\n\n            if (parsedPrompt.isBase64) {\n                // Image is already in base64 format from chat\n                console.log(\"Debug - Using base64 image from chat\");\n                imageB64 = parsedPrompt.mediaFile.split('base64,')[1]; // Remove the data:image/jpeg;base64, prefix\n                fileData = Buffer.from(imageB64, 'base64');\n\n                // Set up paths for potential temp file storage\n                workspaceRoot = process.cwd().replace('/agent', '');\n                while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n                    workspaceRoot = path.dirname(workspaceRoot);\n                }\n                aiImageDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'aiimage');\n\n                // Create temp file for base64 image\n                const tempDir = path.join(aiImageDir, 'temp');\n                if (!fs.existsSync(tempDir)) {\n                    fs.mkdirSync(tempDir, { recursive: true });\n                }\n                mediaPath = path.join(tempDir, `temp_${Date.now()}.jpg`);\n                fs.writeFileSync(mediaPath, fileData);\n            } else {\n                // Image is a file path\n                // Find the workspace root by looking for packages directory\n                // workspaceRoot = process.cwd();\n                workspaceRoot = process.cwd().replace('/agent', '');\n                while (!fs.existsSync(path.join(workspaceRoot, 'packages')) && workspaceRoot !== path.parse(workspaceRoot).root) {\n                    workspaceRoot = path.dirname(workspaceRoot);\n                }\n\n                console.log(\"Debug - Workspace detection:\", {\n                    workspaceRoot,\n                    hasPackagesDir: fs.existsSync(path.join(workspaceRoot, 'packages'))\n                });\n\n                aiImageDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'aiimage');\n                mediaPath = path.join(aiImageDir, parsedPrompt.mediaFile);\n                const absolutePath = path.resolve(mediaPath);\n\n                console.log(\"Debug - File paths:\", {\n                    workspaceRoot,\n                    aiImageDir,\n                    mediaPath,\n                    absolutePath,\n                    cwd: process.cwd(),\n                    exists: fs.existsSync(mediaPath),\n                    dirExists: fs.existsSync(aiImageDir)\n                });\n\n                // Ensure aiimage directory exists\n                if (!fs.existsSync(aiImageDir)) {\n                    console.log(\"Debug - Creating aiimage directory\");\n                    fs.mkdirSync(aiImageDir, { recursive: true });\n                }\n\n                // Test file access\n                try {\n                    await fs.promises.access(mediaPath, fs.constants.R_OK);\n                    console.log(\"Debug - File is readable at path:\", mediaPath);\n\n                    const stats = await fs.promises.stat(mediaPath);\n                    console.log(\"Debug - File stats:\", {\n                        size: stats.size,\n                        isFile: stats.isFile(),\n                        permissions: stats.mode\n                    });\n                } catch (error) {\n                    console.error(\"Debug - File access error:\", {\n                        error: error instanceof Error ? error.message : String(error),\n                        path: mediaPath\n                    });\n                }\n\n                // Ensure the file exists\n                if (!fs.existsSync(mediaPath)) {\n                    console.error(`Media file not found: ${mediaPath}`);\n                    // Try listing directory contents\n                    try {\n                        const dirContents = await fs.promises.readdir(path.dirname(mediaPath));\n                        console.log(\"Debug - Directory contents:\", {\n                            path: path.dirname(mediaPath),\n                            files: dirContents\n                        });\n                    } catch (dirError) {\n                        console.error(\"Debug - Failed to read directory:\", dirError);\n                    }\n                    throw new NimError(\n                        NimErrorCode.FILE_NOT_FOUND,\n                        `Media file not found: ${mediaPath}`,\n                        ErrorSeverity.HIGH\n                    );\n                }\n\n                // Read the file\n                console.log(\"Debug - Reading file from path\");\n                fileData = fs.readFileSync(mediaPath);\n                imageB64 = fileData.toString('base64');\n            }\n\n            // ------------------------------------------------------------------------------------------------\n            // Core AI Image detection logic\n            // ------------------------------------------------------------------------------------------------\n            logGranular(\"Making request to NVIDIA NIM API\", {\n                model: \"hive/ai-generated-image-detection\",\n                hasMediaFile: true,\n                imageSize: fileData.length,\n                isBase64Image: parsedPrompt.isBase64\n            });\n\n            try {\n                let payload;\n                let headers: ApiHeaders = {\n                    \"Authorization\": `Bearer ${config.NVIDIA_NIM_API_KEY}`,\n                    \"Accept\": \"application/json\"\n                };\n\n                // Handle large files through asset upload\n                if (imageB64.length < 180000) {\n                    payload = {\n                        input: [`data:image/jpeg;base64,${imageB64}`]\n                    };\n                    headers[\"Content-Type\"] = \"application/json\";\n                } else {\n                    // For base64 images from chat, we need to save them first\n                    let tempPath: string | null = null;\n                    let uploadPath = mediaPath;\n                    //let uploadPath = path.join(workspaceRoot, mediaPath);\n\n                    if (parsedPrompt.isBase64) {\n                        const tempDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'aiimage', 'temp');\n                        //const tempDir = path.join(workspaceRoot, 'packages', 'plugin-nvidia-nim', 'src', 'assets', 'deepfake', 'temp');\n                        if (!fs.existsSync(tempDir)) {\n                            fs.mkdirSync(tempDir, { recursive: true });\n                        }\n                        tempPath = path.join(tempDir, `temp_${Date.now()}_large.jpg`);\n                        fs.writeFileSync(tempPath, fileData);\n                        uploadPath = tempPath;\n                    }\n\n                    // Upload the file and get the asset ID\n                    const assetManager = new AssetManager(config.NVIDIA_NIM_API_KEY);\n                    const uploadedAsset = await assetManager.uploadAsset(uploadPath);\n\n                    // Clean up temp file if we created one\n                    if (tempPath && fs.existsSync(tempPath)) {\n                        fs.unlinkSync(tempPath);\n                    }\n\n                    payload = {\n                        input: [`data:image/jpeg;asset_id,${uploadedAsset.assetId}`]\n                    };\n                    headers[\"Content-Type\"] = \"application/json\";\n                    headers[\"NVCF-INPUT-ASSET-REFERENCES\"] = uploadedAsset.assetId;\n                }\n\n                // Make the API request\n                const apiUrl = 'https://ai.api.nvidia.com/v1/cv/hive/ai-generated-image-detection';\n                console.log(\"Debug - Making API request:\", {\n                    url: apiUrl,\n                    payloadSize: JSON.stringify(payload).length,\n                    hasAuth: !!headers.Authorization\n                });\n\n                const { data: response } = await axios.post(\n                    apiUrl,\n                    payload,\n                    {\n                        headers,\n                        maxBodyLength: Infinity,\n                        maxContentLength: Infinity\n                    }\n                );\n\n                console.log(\"Debug - API Response received:\", {\n                    status: 'success',\n                    dataLength: JSON.stringify(response).length\n                });\n\n                const aiImageResponse = response as AIImageResponse;\n\n                logGranular(\"Successfully received response from NVIDIA NIM\", {\n                    response: aiImageResponse\n                });\n\n                // Process the analysis results\n                const analysis: AIImageAnalysis = aiImageResponse.data[0];\n\n                logGranular(\"Processing analysis results\", {\n                    analysis\n                });\n\n                const aiProbability = (analysis.is_ai_generated * 100).toFixed(2);\n\n                // Find the most likely source\n                const sources = Object.entries(analysis.possible_sources);\n                const topSource = sources.reduce((prev, curr) =>\n                    curr[1] > prev[1] ? curr : prev\n                );\n                const sourceConfidence = (topSource[1] * 100).toFixed(2);\n\n                const analysisText = `AI Image Analysis: Image is ${aiProbability}% likely to be AI-generated. ${\n                    topSource[0] !== 'none'\n                        ? `Most likely source: ${topSource[0]} (${sourceConfidence}% confidence).`\n                        : 'No specific AI source identified.'\n                }`;\n\n                const processedData = {\n                    response: \"Analyzed image for AI generation\",\n                    analysis: [analysis]\n                };\n\n                if (callback) {\n                    callback({\n                        text: analysisText,\n                        success: true,\n                        mediaPath,\n                        data: processedData\n                    } as AIImageContent);\n                }\n\n                return true;\n            } catch (error) {\n                logGranular(\"Failed to get response from NVIDIA NIM\", { error });\n                if (callback) {\n                    callback({\n                        text: `Error analyzing image: ${error instanceof Error ? error.message : String(error)}`,\n                        success: false,\n                        mediaPath: mediaPath,\n                        data: {\n                            error: error instanceof Error ? error.message : String(error)\n                        }\n                    } as AIImageContent);\n                }\n                throw new NimError(\n                    NimErrorCode.API_ERROR,\n                    \"Failed to get response from NVIDIA NIM\",\n                    ErrorSeverity.HIGH,\n                    { originalError: error }\n                );\n            }\n        } catch (error) {\n            logGranular(\"Failed to execute GET_AI_IMAGE action\", { error });\n            throw new NimError(\n                NimErrorCode.NETWORK_ERROR,\n                \"Failed to execute GET_AI_IMAGE action\",\n                ErrorSeverity.HIGH,\n                { originalError: error }\n            );\n        }\n    }\n};\n\nexport default getAIImageAction;\n\n","import { Plugin } from \"@elizaos/core\";\nimport chalk from 'chalk';\nimport Table from 'cli-table3';\nimport ora from 'ora';\nimport { getConfig } from \"./environment\";\nimport getTopicAction from \"./actions/actionGetTopic\";\nimport getSafetyAction from \"./actions/actionGetSafety\";\nimport getJailBreakAction from \"./actions/actionGetJailBreak\";\nimport getCosmosDescriptionAction from \"./actions/actionGetCosmos\";\nimport getDeepFakeAction from \"./actions/actionGetDeepFake\";\nimport getAIImageAction from \"./actions/actionGetAIImage\";\n\n// Start the loader\nconst spinner = ora({\n  text: chalk.cyan('Initializing NVIDIA NIM Plugin...'),\n  spinner: 'dots12',\n  color: 'cyan'\n}).start();\n\nconst actions = [\n  getTopicAction,\n  getSafetyAction,\n  getJailBreakAction,\n  getCosmosDescriptionAction,\n  getDeepFakeAction,\n  getAIImageAction\n];\n\n// Get NVIDIA_NIM_SPASH from config\nconst NVIDIA_NIM_SPASH = getConfig().NVIDIA_NIM_SPASH;\n\n// Only show splash screen if NVIDIA_NIM_SPASH is true\nif (NVIDIA_NIM_SPASH) {\n  // Initial banner with chalk styling\n  console.log('\\n' + chalk.cyan('┌────────────────────────────────────────┐'));\n  console.log(chalk.cyan('│') + chalk.yellow.bold('          NVIDIA NIM PLUGIN             ') + chalk.cyan(' │'));\n  console.log(chalk.cyan('├────────────────────────────────────────┤'));\n  console.log(chalk.cyan('│') + chalk.white('  Initializing NVIDIA NIM Services...    ') + chalk.cyan('│'));\n  console.log(chalk.cyan('│') + chalk.white('  Version: 1.0.0                        ') + chalk.cyan('│'));\n  console.log(chalk.cyan('└────────────────────────────────────────┘'));\n\n  // Stop the loader\n  spinner.succeed(chalk.green('NVIDIA NIM Plugin initialized successfully!'));\n\n  // Create a beautiful table for actions\n  const actionTable = new Table({\n    head: [\n      chalk.cyan('Action'),\n      chalk.cyan('H'),\n      chalk.cyan('V'),\n      chalk.cyan('E'),\n      chalk.cyan('Similes')\n    ],\n    style: {\n      head: [],\n      border: ['cyan']\n    }\n  });\n\n  // Format and add action information\n  actions.forEach(action => {\n    actionTable.push([\n      chalk.white(action.name),\n      typeof action.handler === 'function' ? chalk.green('✓') : chalk.red('✗'),\n      typeof action.validate === 'function' ? chalk.green('✓') : chalk.red('✗'),\n      action.examples?.length > 0 ? chalk.green('✓') : chalk.red('✗'),\n      chalk.gray(action.similes?.join(', ') || 'none')\n    ]);\n  });\n\n  // Display the action table\n  console.log('\\n' + actionTable.toString());\n\n  // Plugin status with a nice table\n  const statusTable = new Table({\n    style: {\n      border: ['cyan']\n    }\n  });\n\n  statusTable.push(\n    [chalk.cyan('Plugin Status')],\n    [chalk.white('Name    : ') + chalk.yellow('nvidia-nim')],\n    [chalk.white('Actions : ') + chalk.green(actions.length.toString())],\n    [chalk.white('Status  : ') + chalk.green('Loaded & Ready')]\n  );\n\n  console.log('\\n' + statusTable.toString() + '\\n');\n} else {\n  // Stop the loader silently if splash is disabled\n  spinner.stop();\n}\n\nconst nvidiaNimPlugin: Plugin = {\n  name: \"nvidia-nim\",\n  description: \"NVIDIA NIM Plugin for AI Foundation Models integration\",\n  actions: actions,\n  evaluators: []\n};\n\n// Export for both CommonJS and ESM\nexport { nvidiaNimPlugin };\nexport default nvidiaNimPlugin;\n"]}